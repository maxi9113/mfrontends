var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import asyncScriptLoader from './asyncScriptLoader';
let didIncludeOnce = false;
const DEFAULT_SD = 'https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.4.1/bundles/webcomponents-sd.js';
const DEFAULT_CE = 'https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.4.1/bundles/webcomponents-ce.js';
const DEFAULT_AD = 'https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/2.4.1/custom-elements-es5-adapter.js';
const includePolyfills = (options, plugins) => __awaiter(void 0, void 0, void 0, function* () {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
    if (didIncludeOnce) {
        return;
    }
    const scriptsList = [];
    let useSD = '';
    let useCE = '';
    let useAD = '';
    const polyfillLoaderPlugin = (_a = plugins) === null || _a === void 0 ? void 0 : _a.find((plugin) => plugin.name === 'polyfill-loader');
    const disableSD = ((_c = (_b = polyfillLoaderPlugin) === null || _b === void 0 ? void 0 : _b.options) === null || _c === void 0 ? void 0 : _c.use.sd) === false;
    const disableCE = ((_e = (_d = polyfillLoaderPlugin) === null || _d === void 0 ? void 0 : _d.options) === null || _e === void 0 ? void 0 : _e.use.ce) === false;
    const disableAD = ((_g = (_f = polyfillLoaderPlugin) === null || _f === void 0 ? void 0 : _f.options) === null || _g === void 0 ? void 0 : _g.use.adapter) === false;
    if ((_j = (_h = polyfillLoaderPlugin) === null || _h === void 0 ? void 0 : _h.options) === null || _j === void 0 ? void 0 : _j.use.sd) {
        useSD = typeof ((_k = polyfillLoaderPlugin.options) === null || _k === void 0 ? void 0 : _k.use.sd) === 'string'
            ? (_l = polyfillLoaderPlugin.options) === null || _l === void 0 ? void 0 : _l.use.sd : DEFAULT_SD;
    }
    if ((_o = (_m = polyfillLoaderPlugin) === null || _m === void 0 ? void 0 : _m.options) === null || _o === void 0 ? void 0 : _o.use.ce) {
        useCE = typeof ((_p = polyfillLoaderPlugin.options) === null || _p === void 0 ? void 0 : _p.use.ce) === 'string'
            ? (_q = polyfillLoaderPlugin.options) === null || _q === void 0 ? void 0 : _q.use.ce : DEFAULT_CE;
    }
    if ((_s = (_r = polyfillLoaderPlugin) === null || _r === void 0 ? void 0 : _r.options) === null || _s === void 0 ? void 0 : _s.use.adapter) {
        useAD = typeof ((_t = polyfillLoaderPlugin.options) === null || _t === void 0 ? void 0 : _t.use.adapter) === 'string'
            ? polyfillLoaderPlugin.options.use.adapter
            : DEFAULT_AD;
    }
    if (options.usesShadow && !disableSD) {
        scriptsList.push(asyncScriptLoader(useSD || DEFAULT_SD, 'wcPolyfillsLoaded'));
    }
    if (!disableCE) {
        scriptsList.push(asyncScriptLoader(useCE || DEFAULT_CE, 'wcPolyfillsLoaded'));
    }
    if (!disableAD) {
        scriptsList.push(asyncScriptLoader(useAD || DEFAULT_AD, 'wcPolyfillsLoaded'));
    }
    try {
        yield Promise.all(scriptsList);
        didIncludeOnce = true;
    }
    catch (error) {
        console.error(error);
    }
});
export default includePolyfills;
